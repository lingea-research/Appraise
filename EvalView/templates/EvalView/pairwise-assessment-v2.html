{% extends "Dashboard/base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'EvalView/css/pairwise-assessment-v2.css' %}">
<script src="{% static 'EvalView/js/js.cookie-2.2.1.min.js' %}"></script>
<script src="{% static 'EvalView/js/pairwise-assessment-v2.js' %}"></script>
{% endblock %}

{% block content %}
<div class="layout-controls" role="group" aria-label="Assessment layout options">
  <button type="button" class="layout-button" data-orientation-choice="stacked" aria-pressed="false">
    <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
    <span class="layout-label">Stacked</span>
  </button>
  <button type="button" class="layout-button" data-orientation-choice="vertical" aria-pressed="false">
    <span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span>
    <span class="layout-label">Vertical</span>
  </button>
  <button type="button" class="layout-button" data-orientation-choice="horizontal" aria-pressed="false">
    <span class="glyphicon glyphicon-option-horizontal" aria-hidden="true"></span>
    <span class="layout-label">Horizontal</span>
  </button>
</div>

<div class="layout-controls" data-layout-group="width" role="group" aria-label="Assessment width options">
  <button type="button" class="layout-button" data-width-choice="narrow" aria-pressed="false">
    <span class="glyphicon glyphicon-resize-small" aria-hidden="true"></span>
    <span class="layout-label">Narrow</span>
  </button>
  <button type="button" class="layout-button" data-width-choice="wide" aria-pressed="false">
    <span class="glyphicon glyphicon-resize-full" aria-hidden="true"></span>
    <span class="layout-label">Wide</span>
  </button>
</div>

{% if candidate2_text %}
<div class="layout-controls" data-layout-group="diff" role="group" aria-label="Diff highlight options">
  <button type="button" class="layout-button" data-diff-choice="show" aria-pressed="false" accesskey="4">
    <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
    <span class="layout-label">Show diff</span>
  </button>
  <button type="button" class="layout-button" data-diff-choice="hide" aria-pressed="false" accesskey="6">
    <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
    <span class="layout-label">Hide diff</span>
  </button>
</div>
{% endif %}

<div class="assessment-shell" data-layout-container data-orientation="vertical">

<form action="{{action_url}}" method="post" onsubmit="javascript:add_end_timestamp();" data-assessment-form data-orientation="vertical">
{% csrf_token %}

<div class="assessment-header">
  <div class="row">
    <div class="col-sm-4 col-xs-12">
      <span class="text-muted">{{campaign}}:{{datask_id}}:{{item_id}}</span><br>
      <strong id="task_progress">{% if trusted_user %}<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> {% endif %}Item {{num_items_done}}/{{num_items_total}}</strong>
    </div>
    <div class="col-sm-4 col-xs-12 text-center">
    </div>
    <div class="col-sm-4 col-xs-12 text-right">
      <span class="text-muted">Language pair</span><br>
      <strong>{% if source_language %}{{source_language}} &rarr; {% endif %}{{target_language}}</strong>
    </div>
  </div>
</div>

<div class="question-box">
  <p class="priming-question">
    How accurately does each of the candidate text(s) below convey the original semantics of the source text?
  </p>
</div>

<input name="end_timestamp" type="hidden" value="" />
<input name="item_id" type="hidden" value="{{item_id}}" />
<input name="task_id" type="hidden" value="{{task_id}}" />
<input name="start_timestamp" type="hidden" value="" />
<input name="score" type="hidden" value="-1" />
{% if candidate2_text %}
<input name="score2" type="hidden" value="-1" />
{% endif %}
<input name="metadata" type="hidden" value="{}" />

<div class="comparison-deck" data-comparison-deck>
  <div class="reference-panel" data-reference-label="{{reference_label}}">
    <div class="context-sentences" style="display: none">
      {% if context_left %}
        <p><small>{{context_left|safe}}</small></p>
      {% endif %}
    </div>

    <p><strong>{{reference_text|safe}}</strong></p>
    <p class="quotelike-author" id="reference-label">{{reference_label}}</p>

    <div class="context-sentences" style="display: none">
      {% if context_right %}
        <p><small>{{context_right|safe}}</small></p>
      {% endif %}
    </div>
  </div>

  <div class="candidate-card" data-pseudo-content="Candidate A" data-candidate-index="1">
    <p class="candidate-text"><strong>{{candidate_text|safe}}</strong></p>
    <div class="rating-row">
      {% with sliderid='' %}
      {% include 'EvalView/_quality_slider.html' %}
      {% endwith %}
    </div>
  </div>

  {% if candidate2_text %}
  <div class="candidate-card" data-pseudo-content="Candidate B" data-candidate-index="2">
    <p class="candidate-text"><strong>{{candidate2_text|safe}}</strong></p>
    <div class="rating-row">
      {% with sliderid='2' %}
      {% include 'EvalView/_quality_slider.html' %}
      {% endwith %}
    </div>
  </div>
  {% endif %}

</div>

{% if candidate2_text %}
<div class="preference-section preference-inactive" id="preference-section">
  <h3 class="preference-title" id="preference-title">Preference</h3>
  <p class="preference-status" id="preference-status"></p>
  <fieldset id="preference-fieldset" class="preference-fieldset" aria-labelledby="preference-title" aria-describedby="preference-status" disabled>
    <legend class="sr-only">Preference between the two candidates</legend>
    <div class="preference-options" role="radiogroup" aria-labelledby="preference-title">
      <label class="preference-option" data-preference-value="A>>B">
        <input type="radio" name="preference" value="A>>B" data-preference-extreme="true">
        <span>A is better</span>
      </label>
      <label class="preference-option" data-preference-value="A>B">
        <input type="radio" name="preference" value="A>B">
        <span>A is slightly preferred</span>
      </label>
      <label class="preference-option" data-preference-value="A=B">
        <input type="radio" name="preference" value="A=B">
        <span>A and B are equal</span>
      </label>
      <label class="preference-option" data-preference-value="A<B">
        <input type="radio" name="preference" value="A<B">
        <span>B is slightly preferred</span>
      </label>
      <label class="preference-option" data-preference-value="A<<B">
        <input type="radio" name="preference" value="A<<B" data-preference-extreme="true">
        <span>B is better</span>
      </label>
    </div>
  </fieldset>
</div>
{% endif %}

<div class="comment-section" data-comment-section data-comments-required="{% if comments_required %}true{% else %}false{% endif %}">
  <label for="comment-field" class="comment-label">
    Comment
    {% if comments_required %}<span class="comment-required-indicator" aria-hidden="true">*</span>{% endif %}
  </label>
  <p id="comment-help" class="comment-help">
    {% if comments_required %}
    A comment is required for this task. Share any details that justify your decision.
    {% else %}
    Optional but helpfulâ€”use this space to capture anything noteworthy about the item.
    {% endif %}
  </p>
  <textarea id="comment-field" name="comment" class="form-control comment-field" rows="4" aria-describedby="comment-help" {% if comments_required %}required aria-required="true"{% else %}aria-required="false"{% endif %} placeholder="Add any notes for this assessment..."></textarea>

  <div class="quick-comment-section">
    <span class="quick-comment-title">Quick comments</span>
    <div class="quick-comment-buttons" data-quick-comments aria-live="polite"></div>
  </div>
</div>

<div class="actions">
  <table style="width:100%">
  <tr>
    <td style="width:50%;text-align:left;">
      <button onclick="javascript:reset_form();" accesskey="2" type="reset" class="btn btn-default"
        title="Reset the rating buttons. Access key: '2'"><i class="icon-repeat"></i> Reset</button>

      {% if context_left or context_right %}
      <button onclick="javascript:toggle_context();" accesskey="5" type="button" class="btn btn-default"
              title="Show or hide the context. Access key: '5'">Show/Hide context</button>
      {% endif %}
    </td>
    <td style="width:50%;text-align:right;">
      {% if candidate2_text %}
      <button onclick="javascript:match_ratings();" accesskey="3" type="button" class="btn btn-default"
        title="Match the second rating with the first one. Access key: '3'">Match ratings</button>
      {% endif %}
      <button class="btn btn-primary" name="submit_button" accesskey="1" type="submit" value="SUBMIT" onclick="javascript:return validate_form();"
              title="Submit score(s). Access key: '1'"><i class="icon-ok-sign icon-white"></i> Submit</button>
    </td>
  </tr>
  </table>
</div>

</form>

</div>

{% endblock %}
